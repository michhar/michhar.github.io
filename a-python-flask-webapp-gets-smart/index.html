<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Creating a Smart Python Flask Web App using Azure Machine Learning - Data Science <3 Machine Learning</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/obsidian.min.css">
        <link href="../extra_css/extra.css" rel="stylesheet">
        <link href="../extra_css/syntax.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-86308542-1', 'auto');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="..">Data Science <3 Machine Learning</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Posts <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2023-07-poetry-with-conda/" class="dropdown-item">How to Use Poetry with Conda for Package Management on a Specific Python Version</a>
</li>
                                    
<li>
    <a href="../survive-thrive-ds-career/" class="dropdown-item">Survive and Thrive in Your Data Science Career Meetup Summary</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Archive <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2019</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../learning-from-learning-yolov3/" class="dropdown-item">Lessons from YOLO v3 Implementations in PyTorch</a>
</li>
            
<li>
    <a href="../bilstm-crf-this-is-mind-bending/" class="dropdown-item">Named Entity Recognition using a Bi-LSTM with the Conditional Random Field Algorithm</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2018</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../how-i-built-pytorch-gpu/" class="dropdown-item">Building PyTorch with LibTorch From Source with CUDA Support</a>
</li>
            
<li>
    <a href="../convert-pytorch-onnx/" class="dropdown-item">How to Convert a PyTorch Model to ONNX Format</a>
</li>
            
<li>
    <a href="../convolutional-in-layers-and-sequences/" class="dropdown-item">Convolutional Neural Networks in Four Deep Learning Frameworks by Example</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2017</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../cntk-has-feelings-too/" class="dropdown-item">The Cognitive Toolkit (CNTK) Understands How You Feel</a>
</li>
            
<li>
    <a href="../masks_to_polygons_and_back/" class="dropdown-item">Shapely Shapes and OpenCV Visions</a>
</li>
            
<li>
    <a href="../my-new-static-site-generator-hobby/" class="dropdown-item">Overlaying a Website ontop of a GitHub Repository</a>
</li>
            
<li>
    <a href="../two-cents-on-python-package-structure/" class="dropdown-item">Wading In a Tide Pool of Choices, How to Write a Package in Python?</a>
</li>
            
<li>
    <a href="../ocrbot-gets-attached/" class="dropdown-item">OCRBot Gets Attached</a>
</li>
            
<li>
    <a href="../jupyter-and-beaker-make-a-case/" class="dropdown-item">The Notebook Superhero -- Is It Always a Contest?</a>
</li>
            
<li>
    <a href="../javascript-and-python-have-a-party/" class="dropdown-item">Javascript and Python Meet through Magic and IPython</a>
</li>
            
<li>
    <a href="../confusion-matrix-code-revealed/" class="dropdown-item">A Simple, Presentable Confusion Matrix with K-means Data</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Creating a Smart Python Flask Web App using Azure Machine Learning</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2016</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ocrbot-makes-a-connection/" class="dropdown-item">OCRBot Makes a Connection to the Cloud</a>
</li>
            
<li>
    <a href="../how-to-bot-on-mac/" class="dropdown-item">Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac</a>
</li>
            
<li>
    <a href="../teaching-notes-post/" class="dropdown-item">Tips I have Learned by Being a Trainer for a Year</a>
</li>
            
<li>
    <a href="../notebooks1-post/" class="dropdown-item">Python for Data Science Goes Into the Wild</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../confusion-matrix-code-revealed/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../ocrbot-makes-a-connection/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/michhar/michhar.github.io/edit/master/docs/a-python-flask-webapp-gets-smart.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><img alt="header pic" src="/img/flask-post-diagram.png" /></p>
<p><strong>tl;dr</strong>:  Azure Machine Learning + Visual Studio + Python Flask + GitHub + Azure = A Live Custom ML Model for You!</p>
<p><strong>Posted:</strong>  2017-02-05</p>
<h2 id="introduction">Introduction</h2>
<p>Ok, so I have an interesting REST endpoint (in my case, a machine learning model for using a company's Wikipedia article to find similar companies), what can I do next?  Why not serve it up in a simple web app to impress friends and wow colleagues?  (Really, you can use this intel to create a web app around any REST endpoint, as half of my purpose in writing this is to show how fast and easy Python Flask is).</p>
<p>Essentially, we are making a web app wrapper around a data submission and retrieval REST endpoint that is created through Azure Machine Learning (AML) Studio (<a href="https://studio.azureml.net">https://studio.azureml.net</a>), a friendly and powerful machine learning tool with a handy browser UI.  In this post, the endpoint is a service that clusters companies based on descriptive text (our input data).  The clustering model, a k-means algorithm, has been trained on close to 500 wikipedia entries, a cool example of <a href="https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-algorithm-choice#unsupervised">unsupervised learning</a>.  If you don't know much yet about AML Studio and would like to know more <a href="https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-what-is-ml-studio">this</a> is a good place to start or dive in and learn by doing with a quick getting-started tutorial <a href="https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-create-experiment">here</a>.  You'll need to know, at least, how to publish an experiment from Studio to get your Flask web app going.</p>
<p>The ML web service is based around an AML scoring experiment, built from a training experiment in which <code>K-Means Clustering</code> module is used to assign companies to groups based on features in their processed Wikipedia text.   The <code>Extract N-Gram Features from Text</code> module (more info <a href="https://msdn.microsoft.com/library/azure/a8a662d0-89bb-48c9-8562-9b9589124c4a">here</a>) is used after some initial cleansing of the text data (remove stop words, numbers, special characters, detect sentences, etc. - see the <code>Preprocess Text</code> AML module <a href="https://msdn.microsoft.com/en-us/library/mt762915.aspx">here</a>) to extract features upon which to train the k-means clustering model and reduce the dimensionality to the most important chunks of information.  The scoring experiment uses a stored vocabulary from the training data n-gram feature extraction process (a good explanation of n-grams can be found in this blog on extracting features from text for classification, a different kind of ML algorithm - check it out <a href="https://www.microsoft.com/developerblog/real-life-code/2015/11/30/Text-based-Feature-Representations-1-Gram-2-Gram-or-3-Gram-But-Just-How-Many-Gram.html">here</a>).</p>
<p>Real quick, an example of extracting n-grams from:  "<em>Time lost is never found.</em>"</p>
<ul>
<li>An example from the blog link I just listed above (this <a href="https://www.microsoft.com/developerblog/real-life-code/2015/11/30/Text-based-Feature-Representations-1-Gram-2-Gram-or-3-Gram-But-Just-How-Many-Gram.html">one</a>)</li>
</ul>
<table>
<thead>
<tr>
<th>Where n=1, that is a uni-gram</th>
<th>Where n=2, that is a bi-gram</th>
<th>Where n=3, that is a tri-gram</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time</td>
<td>Time lost</td>
<td>Time lost is</td>
</tr>
<tr>
<td>lost</td>
<td>lost is</td>
<td>lost is never</td>
</tr>
<tr>
<td>is</td>
<td>is never</td>
<td>is never found</td>
</tr>
<tr>
<td>never</td>
<td>never found</td>
<td></td>
</tr>
<tr>
<td>found</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>So, you have an idea of the initial training dataset (but imagine 10,000 or more of these n-grams as our features from all of that Wikipedia text - it can be seen why feature selection is sometimes helpful for narrowing down to the most important features and we can also do this with the <code>Extract N-Gram Features from Text</code> module in AML).  Ok, let's move on to the app building fun.</p>
<p>Our web app is going to utilize a microframework for building web apps purely in the Python programming language.  A big reason to begin in this framework is that Python, a popular Data Science language, is easy to read and learn and Visual Studio has a Flask web app template as part of the Python Tools for Visual Studio extension, making life much easier for us.  Python, as a language, is also known for being a popular web app development language and has other projects like <a href="https://www.djangoproject.com/">Django</a> and <a href="https://bottlepy.org/docs/dev/">Bottle</a> for these ends (also with templates in VS).</p>
<p>That all being said, most of this post is about creating the Flask web app.  I'll leave it to other guides and articles to discuss working with AML and k-means in detail.</p>
<p><img alt="input for webapp" src="/img/webapp-input.PNG" />
<strong>Above:  The deployed web app site</strong></p>
<h3 id="before-you-begin-a-few-things-to-do">Before you Begin, a Few Things to Do...</h3>
<h4 id="tools">Tools</h4>
<ul>
<li>[recommended]<strong>Visual Studio</strong> installed (Community 2015 Edition is what I use; NB:  the preview of 2017 is adding PTVS soon...I'll update on this later;  also, VS 2017 is available for Mac OSX) (<a href="https://www.visualstudio.com/downloads/">Visual Studio Community</a>) with <strong>Python Tools for Visual Studio</strong> installed (to get the Flask Web App template) which can be added during the install of VS or separately from <a href="https://www.visualstudio.com/vs/python/">here</a></li>
<li><strong>Git Bash</strong> or <strong>git</strong> installed - included in git download</li>
<li><a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a></li>
</ul>
<h4 id="accounts">Accounts</h4>
<ul>
<li><strong>Azure Machine Learning Studio account</strong> from <a href="https://studio.azureml.net">https://studio.azureml.net</a> (free)</li>
<li><strong>GitHub Account</strong> - a code repository and collaboration tool we'll use (free)</li>
<li><a href="https://github.com/join">https://github.com/join</a></li>
<li><strong>Azure account</strong> - use the one you have, sign up for a free trial at <a href="https://azure.microsoft.com/en-us/free/">https://azure.microsoft.com/en-us/free/</a>, or, if you have an MSDN account and Azure as a benefit, link your Microsoft Account or Work/School Account to MSDN and activate the Azure benefit by following <a href="https://www.visualstudio.com/en-us/docs/setup-admin/team-services/link-msdn-subscription-to-organizational-account-vs">this</a> guide</li>
</ul>
<h4 id="prerequisites">Prerequisites</h4>
<ul>
<li>The deployed Azure Machine Learning <em>scoring</em> experiment</li>
<li>Note:  We won't cover this experiment and model here as it's not the focus of this particular post, but a link to instructions is just below.</li>
<li>Aside:  These experiments are often called "predictive", but in a clustering model we really just look for scores and cluster assignments, not predictions so let's call it <em>scoring</em> experiment </li>
</ul>
<p>The scoring experiment which utilizes the k-means model and n-gram featurizer vocabulary created in the training experiment has the following layout in AML Studio:</p>
<p><img alt="kmeans/ngram scoring experiment" src="/img/aml-studio-scoring.png" /></p>
<p>The scoring experiment you will need can be found <a href="https://gallery.cortanaintelligence.com/Experiment/N-Grams-and-Clustering-Find-similar-companies-Scoring-Exp-2">here</a> (this will allow you to launch it in AML Studio).  Essentially, we are using AML Studio as a clever way to deploy a web service and not much more, but it's capabilities as a canvas for creating a data science workflow are worth checking out if you like a visual workflow-type setup.</p>
<p>Start at this spot in the Azure Docs to get this experiment deployed as a web service to use later in this guide post:  <a href="https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-walkthrough-5-publish-web-service#deploy-the-web-service">https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-walkthrough-5-publish-web-service#deploy-the-web-service</a>.</p>
<p>A similar guide with good diagrams on deploying the experiment as a web service can be picked up at section "4.2.2. Publishing a trained model as Web Service" in this tutorial: <a href="https://github.com/Azure-Readiness/hol-azure-machine-learning/blob/master/004-lab-azureml-experiment.md#422-publishing-a-trained-model-as-web-service">https://github.com/Azure-Readiness/hol-azure-machine-learning/blob/master/004-lab-azureml-experiment.md#422-publishing-a-trained-model-as-web-service</a>.</p>
<h3 id="the-web-app-development">The Web App Development</h3>
<p><strong>Note:  Under REQUEST/RESPONSE for the AML Studio experiment (found after deploying as web service from Studio), one will find all of the specs needed to work with this endpoint.</strong></p>
<p>Let's write a web app!  We're going to begin in Visual Studio.  As an aside, did you know VS 2017 is available for Mac?!  What's especially cool is that developers can share projects across Mac and Windows.  The Python Tools for Visual Studio extension isn't available, however, on VS 2017 so I'm eagerly awaiting this capability.  Will report back later.  Since VS 2015 with PTVS is available for us on Windows we will be using the awesome Flask Web Project template that comes with it to kick start our web app dev in Windows 10.</p>
<ul>
<li>
<p>Open VS</p>
</li>
<li>
<p>Create a new Python Flask web app project (this template should exist if one chooses Python - scroll down Templates -&gt; Python -&gt; Flask Web Project) with Python 3.5 (or whichever 3 you have will do) into a virtual environment.  At this point, you literally have a functioning web app.  Hit the Run (your default browser choice is next to the button) in VS and test out this template.</p>
</li>
<li>
<p>Add a new file called <code>forms.py</code> to the main directory (alongside <code>views.py</code>).  This will contain the form-building code through which data will be sent to the REST endpoint for analysis.  There are three fields we need in our input form: title, category and text.  Title is the company title, category is an optional field for the category of company (e.g. information technology) and text is the Wikipedia article text about that company or some descriptive corpus.</p>
</li>
</ul>
<h4 id="the-input-form-define-in-forms">The input form:  define in "forms"</h4>
<p>Place the following text in the <code>forms.py</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span><span class="p">,</span> <span class="n">validators</span>

<span class="c1"># This class will be used in the webapp as the main input form</span>
<span class="k">class</span> <span class="nc">SubmissionForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">30</span><span class="p">)])</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Category&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">30</span><span class="p">)])</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span><span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">)])</span>
</code></pre></div>
<h4 id="the-routing-on-the-page-define-in-the-views">The routing on the page:  define in the "views"</h4>
<p>We will be modifying the existing template code as follows.</p>
<p>The imports should look like:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">FlaskAppAML</span> <span class="kn">import</span> <span class="n">app</span>

<span class="kn">from</span> <span class="nn">FlaskAppAML.forms</span> <span class="kn">import</span> <span class="n">SubmissionForm</span>
</code></pre></div>
<p>Which added json handling, http request handling, os interaction and the way in which the forms class from above is available for use.</p>
<p>Add a way to grab the API_KEY and URL at the beginning of the <code>views.py</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Deployment environment variables defined on Azure (pull in with os.environ)</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;API_KEY&#39;</span><span class="p">,</span> <span class="s2">&quot;optionally place a default value for local dev here&quot;</span><span class="p">)</span>
<span class="n">URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;URL&#39;</span><span class="p">,</span> <span class="s2">&quot;optionally place a default value for local dev here&quot;</span><span class="p">)</span>
</code></pre></div>
<p>and HEADERS global variable:</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Construct the HTTP request header</span>
<span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span> <span class="s1">&#39;Authorization&#39;</span><span class="p">:(</span><span class="s1">&#39;Bearer &#39;</span><span class="o">+</span> <span class="n">API_KEY</span><span class="p">)}</span>
</code></pre></div>
Change the "home route" (landing page functionality), <code>def home</code> method definition, to be:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Our main app page/route</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Renders the home page which is the CNS of the web app currently, nothing pretty.&quot;&quot;&quot;</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">SubmissionForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>

    <span class="c1"># Form has been submitted</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">validate</span><span class="p">():</span>

        <span class="c1"># Plug in the data into a dictionary object </span>
        <span class="c1">#  - data from the input form</span>
        <span class="c1">#  - text data must be converted to lowercase</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="p">{</span>
              <span class="s2">&quot;Inputs&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;input1&quot;</span><span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;ColumnNames&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Title&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Category&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Text&quot;</span>
                  <span class="p">],</span>
                  <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="p">[</span>
                      <span class="n">form</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                      <span class="n">form</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                      <span class="n">form</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="p">]</span>
                  <span class="p">]</span>
                <span class="p">}</span>
              <span class="p">},</span>
              <span class="s2">&quot;GlobalParameters&quot;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">}</span>

        <span class="c1"># Serialize the input data into json string</span>
        <span class="n">body</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

        <span class="c1"># Formulate the request</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">HEADERS</span><span class="p">)</span>

        <span class="c1"># Send this request to the AML service and render the results on page</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># response = requests.post(URL, headers=HEADERS, data=body)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="n">respdata</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">respdata</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
                <span class="s1">&#39;result.html&#39;</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;From your friendly AML experiment&#39;s Web Service:&quot;</span><span class="p">,</span>
                <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># An HTTP error</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
                <span class="s1">&#39;result.html&#39;</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;There was an error&#39;</span><span class="p">,</span>
                <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Just serve up the input form</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
        <span class="s1">&#39;form.html&#39;</span><span class="p">,</span>
        <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Run App&#39;</span><span class="p">,</span>
        <span class="n">year</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Input form to gain insights into a company using Azure Machine Learning&#39;</span><span class="p">)</span>
</code></pre></div>
<h4 id="the-html-templates-how-the-information-gets-served">The html templates:  how the information gets served</h4>
<ul>
<li>We add two new templates:  form.html, result.html</li>
</ul>
<p>The <code>form.html</code> gives us a construct for the user to enter in input data and the <code>result.html</code>, a construct in which the results from the machine learning experiment can be displayed.</p>
<p>Grab the <code>form.html</code> code <a href="https://github.com/michhar/flask-webapp-aml/blob/master/FlaskAppAML/templates/form.html">here</a>.
Grab the <code>result.html</code> code <a href="https://github.com/michhar/flask-webapp-aml/blob/master/FlaskAppAML/templates/result.html">here</a>.  Note, this code may result in slightly different web app appearances to this article.</p>
<p>Now that we have some new code to handle calling the AML web service and html templates to handle input and output, let's prepare to deploy by taking a look at some configuration.</p>
<h3 id="prepare-to-deploy-the-web-app-to-azure">Prepare to Deploy the Web App to Azure</h3>
<p>Before we publish, we must add two configuration-type files:</p>
<ol>
<li>A web configuration file (web.config)</li>
<li>Virtual environment proxy (ptvs_virtualenv_proxy.py)</li>
</ol>
<p>The <code>web.config</code> file may need some modifications, however the virtual environment proxy file should work as is from this folder.</p>
<h4 id="web-configuration-file">Web Configuration file</h4>
<ol>
<li>Add web.config at project level (alongside requirements.txt file)</li>
</ol>
<p>It should look something like the following (you can actually add a template web.config similar to this one in VS by right-clicking on the FlaskAppAML folder -&gt; Add -&gt; New Item -&gt; Azure web.config for FastCGI, but it will need a few modifications).  Note that the Python version may change in the future and this script might need modification.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
<span class="w">  </span><span class="nt">&lt;appSettings&gt;</span>
<span class="w">    </span><span class="nt">&lt;add</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;WSGI_ALT_VIRTUALENV_HANDLER&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;FlaskAppAML.app&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;add</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;WSGI_ALT_VIRTUALENV_ACTIVATE_THIS&quot;</span>
<span class="w">         </span><span class="na">value=</span><span class="s">&quot;D:\home\site\wwwroot\env\Scripts\python.exe&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;add</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;WSGI_HANDLER&quot;</span>
<span class="w">         </span><span class="na">value=</span><span class="s">&quot;ptvs_virtualenv_proxy.get_venv_handler()&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;add</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;PYTHONPATH&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;D:\home\site\wwwroot&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/appSettings&gt;</span>
<span class="w">  </span><span class="nt">&lt;system.web&gt;</span>
<span class="w">    </span><span class="nt">&lt;compilation</span><span class="w"> </span><span class="na">debug=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">targetFramework=</span><span class="s">&quot;4.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/system.web&gt;</span>
<span class="w">  </span><span class="nt">&lt;system.webServer&gt;</span>
<span class="w">    </span><span class="nt">&lt;modules</span><span class="w"> </span><span class="na">runAllManagedModulesForAllRequests=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;handlers&gt;</span>
<span class="w">      </span><span class="nt">&lt;remove</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Python27_via_FastCGI&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;remove</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Python34_via_FastCGI&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;add</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Python FastCGI&quot;</span>
<span class="w">           </span><span class="na">path=</span><span class="s">&quot;handler.fcgi&quot;</span>
<span class="w">           </span><span class="na">verb=</span><span class="s">&quot;*&quot;</span>
<span class="w">           </span><span class="na">modules=</span><span class="s">&quot;FastCgiModule&quot;</span>
<span class="w">           </span><span class="na">scriptProcessor=</span><span class="s">&quot;D:\Python34\python.exe|D:\Python34\Scripts\wfastcgi.py&quot;</span>
<span class="w">           </span><span class="na">resourceType=</span><span class="s">&quot;Unspecified&quot;</span>
<span class="w">           </span><span class="na">requireAccess=</span><span class="s">&quot;Script&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/handlers&gt;</span>
<span class="w">    </span><span class="nt">&lt;rewrite&gt;</span>
<span class="w">      </span><span class="nt">&lt;rules&gt;</span>
<span class="w">        </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Static Files&quot;</span><span class="w"> </span><span class="na">stopProcessing=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;match</span><span class="w"> </span><span class="na">url=</span><span class="s">&quot;^/static/.*&quot;</span><span class="w"> </span><span class="na">ignoreCase=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Rewrite&quot;</span><span class="w"> </span><span class="na">url=</span><span class="s">&quot;^/FlaskAppAML/static/.*&quot;</span><span class="w"> </span><span class="na">appendQueryString=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/rule&gt;</span>
<span class="w">        </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Configure Python&quot;</span><span class="w"> </span><span class="na">stopProcessing=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;match</span><span class="w"> </span><span class="na">url=</span><span class="s">&quot;(.*)&quot;</span><span class="w"> </span><span class="na">ignoreCase=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;conditions&gt;</span>
<span class="w">          </span><span class="nt">&lt;/conditions&gt;</span>
<span class="w">          </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Rewrite&quot;</span><span class="w"> </span><span class="na">url=</span><span class="s">&quot;handler.fcgi/{R:1}&quot;</span><span class="w"> </span><span class="na">appendQueryString=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/rule&gt;</span>
<span class="w">      </span><span class="nt">&lt;/rules&gt;</span>
<span class="w">    </span><span class="nt">&lt;/rewrite&gt;</span>
<span class="w">  </span><span class="nt">&lt;/system.webServer&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
<p>Possible modifications or places of note in the web config:</p>
<ul>
<li>
<p>The <code>WSGI_ALT_VIRTUALENV_HANDLER</code> will very likely need to be modified.  Here it is <code>FlaskAppAML.app</code>, referring to my flask application itself.</p>
</li>
<li>
<p>The line <code>&lt;action type="Rewrite" url="^/FlaskAppAML/static/.*" appendQueryString="true" /&gt;</code> under rules MUST have the correct project name (here mine was FlaskAppAML).  This section ensures the static files (important for the web service appearance) can be found.</p>
</li>
<li>
<p>The <code>scriptProcessor</code>, under <code>handlers</code> in the web.config xml above, must correspond to the resources existing on the web server's file system (e.g. <code>D:\Python34\python.exe</code>).</p>
</li>
</ul>
<h4 id="virtual-environment-proxy">Virtual Environment Proxy</h4>
<p>The code for this set of helper functions can be found <a href="https://docs.microsoft.com/en-us/azure/app-service-web/web-sites-python-configure#virtual-environment-proxy">here</a> in the Azure documentation (that similar article talks about deploying continuously from a git repository - a good method to know as well).</p>
<p>Just include <code>ptvs_virtualenv_proxy</code> in the base of your project along with the <code>web.config</code> (and auto-created <code>requirements.txt</code> and <code>runserver.py</code>).</p>
<p>Finally, to test all of this code locally just click the run button in the navi in VS (your default browser should also appear there).</p>
<p>Congrats, you have tested this locally and things seem to be good.</p>
<h3 id="deploy-the-flask-web-app">Deploy the Flask Web App</h3>
<h4 id="option-1-set-up-a-github-repository-as-the-deployment-option">Option 1: Set up a GitHub Repository as the Deployment Option</h4>
<p>This is the most customizable way, hence more complex, but also the most transparent and easy to troubleshoot.  </p>
<ol>
<li>Log in to GitHub and create a new repository (I called mine <code>flask-webapp-aml</code>, initializing with a README and a .gitignore for Visual Studio files.</li>
<li>In Git bash on the Desktop, type into the terminal the command to clone the new repository, for example: (I'm using SSH because it will allow me to push changes back up):</li>
<li><code>git clone git@github.com:&lt;your github username without these triangle brackets&gt;/flask-webapp-aml.git</code></li>
<li>Copy all of the project code to this new repository folder locally (I just <code>cp</code> on the command line in Git bash) to match this structure:
<div class="highlight"><pre><span></span><code>  FlaskAppAML/
  FlaskAppAML/__init__.py
  FlaskAppAML/forms.py
  FlaskAppAML/views.py
  FlaskAppAML/static -&gt; *our static files*
  FlaskAppAML/templates -&gt; *the html page templates*
  env/ -&gt; *the entire python environment*
  ptvs_virtualenv_proxy.py
  README.md
  requirements.txt
  runserver.py
  runtime.txt
  web.config
  .skipPythonDeployment
</code></pre></div></li>
<li>If the empty <code>.skipPythonDeployment</code> file is not in the base of your repository, add one now.  Also, make sure the <code>env</code> folder from the VS project is present.  This contains all of the python environment needed for running this web app (really anywhere).  We are skipping having the web service custom install all of the necessary modules by giving the service this <code>.skipPythonDeployment</code> file and the <code>env</code> folder.</li>
<li>Add "__pycache__" on it's own line to my ".gitignore" file and anything you don't want uploaded to the GitHub when we "push" changes.</li>
<li>
<p>Now it all seems pretty tidy, so it's time to push the changes up to be hosted on GitHub.  I <em>add</em> ("stage"), <em>commit</em> (commit my code locally with a message) and <em>push</em> (push up to the web to be hosted on GitHub) all of my additions or any changes I've made.  I can do this <em>add/commit/push</em> again as many times as I want in the future.  I must, however, do all three consecutively and in that order otherwise it gets complicated.  So, my commands look like:</p>
<ul>
<li><code>git add .</code> (from the base of the repository)</li>
<li><code>git commit -m "initial commit message"</code> (the -m is our message so be brief, but descriptive - visible to the world)</li>
<li><code>git push</code> (we could also have written <code>git push origin master</code>, but it's not necessary to be so verbose right now)</li>
</ul>
</li>
<li>
<p>Create an App Service Web App in the Azure Portal (<a href="https://portal.azure.com">https://portal.azure.com</a>) by clicking "+" and search for "web app", then go through the wizard to create one.</p>
</li>
<li>Update the Deployment options in the Azure Portal for the web app.  For our Web App, under "APP DEPLOYMENT", open the "Deployment options" blade.  For Choose Source, choose GitHub (you may have to log in to your GitHub here to link it).  Under Choose project, pick the GitHub repository to which you just pushed code and click OK.</li>
<li>Now we add a couple of variables to the Azure Portal Web App for safe-keeping.  There are "environmental variables" in the code (they look like <code>os.environ.get('FOO')</code>):  one for the AML Web Service's URL and one for the API_KEY - these are the necessary values we need to access our published AML scoring experiment.  To have these available for our web app we need to put them somewhere discoverable and that is as variables under "App settings" in the "Application settings" blade for our own Web App in the Azure Portal.
 <img alt="image of entering in keys to Azure portal app service" src="/img/flaskapp-adding-sys-vars.jpg" /></li>
<li>Ensure that, in the Portal, under Application Settings, Python is set to the appropriate version (default is that "Python" is Off in settings - so will need to manually switch to it's version).</li>
<li>If we go back to the "Deployment options" we can see how our build is going.  This process will automatically happen for us every time a new change is made to our GitHub repository.  Ensure that this build completes successfully.</li>
<li>Finally, if you go to "Overview" and click on the web app's URL, you'll see your site.</li>
</ol>
<p>Congrats on completing this process!  You should now have a functioning barebones, machine learning web app.  Go ahead and try it out. :)</p>
<p><img alt="input for webapp" src="/img/webapp-output.PNG" /></p>
<p>If you encounter any problems, check the Troubleshooting section below, Azure docs, or StackOverflow.  Also, leave a comment if it's a bug in the code or process.</p>
<h4 id="option-2-publish-and-deploy-from-vs-as-an-azure-app-service-web-app">Option 2: Publish and Deploy from VS as an Azure App Service Web App</h4>
<p>To deploy we must also publish this project to Azure (it's done together with VS).  Fortunately, from within VS (note, I'm in VS 2017, but it's available in previous releases) there's a <strong>"Publish..."</strong> option.  Right-click on the project name and in the pop-up <strong>"Publish..."</strong> should be available.  Click this and simply go through the wizard to set up an Azure App Service Web App.  It should be very straightforward and easy to do.</p>
<p>As an alternative to publishing/deploying directly from VS, one can leverage a git repository or use code on GitHub as a deployment option.  Similar instructions can be found in <a href="https://docs.microsoft.com/en-us/azure/app-service-web/web-sites-python-configure">this</a> Azure article.</p>
<h3 id="make-it-your-own">Make it Your Own</h3>
<p>Modify the <code>layout.html</code> file with app name and navi layout changes.  Or change your custom stylesheet under static -&gt; content -&gt; site.css.</p>
<p>Go grab all of the code at <a href="https://github.com/michhar/flask-webapp-aml">https://github.com/michhar/flask-webapp-aml</a> and add it to a project, test, develop and deploy.  You could even if you wish just fork this repository and deploy directly from that in the Azure Portal, but then that would have been too easy. ;)</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<ul>
<li>All sample code can be found at <a href="https://github.com/michhar/flask-webapp-aml">https://github.com/michhar/flask-webapp-aml</a> - it may, over time, have more complex samples, so check it out.</li>
<li>Go to Application Settings and ensure Python is enabled along with other key settings in the Azure Portal</li>
<li>Go to Console (under Development Tools) and make sure all files and programs specified in the <code>web.config</code> exists.</li>
<li>Ensure in <code>web.config</code>, that the "scriptProcessor" key/value in handlers is correct (that these paths exist on the server file system).</li>
<li>Check FREB Logs in the Portal for more information around warnings and errors (make sure you are logging for those during this phase).</li>
<li>Post comments here or if around the code, under issues here:  <a href="https://github.com/michhar/flask-webapp-aml/issues">https://github.com/michhar/flask-webapp-aml/issues</a> - many thanks!</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
